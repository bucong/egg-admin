<%- include ../public/pageHeader.html %>
<link rel="stylesheet" href="../../../public/plugin/wangEditor/wangEditor.min.css">
<link rel="stylesheet" href="../../../public/plugin/webuploader/css/diyUpload.css">
<link rel="stylesheet" href="../../../public/plugin/webuploader/css/webuploader.css">
<div class="iframe-content goods">
  <h1>添加商品</h1>
  <form method="post" action="/admin/goods/doAdd?_csrf=<%= csrf %>" enctype="multipart/form-data">
    <ul class="nav nav-tabs">
      <li class="active"><a href="#general" data-toggle="tab">通用信息</a></li>
      <li><a href="#detail" data-toggle="tab">详细描述</a></li>
      <li><a href="#attribute" data-toggle="tab">规格与包装</a></li>
      <li><a href="#photo" data-toggle="tab">商品相册</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="general">
        <div class="form-group">
          <label for="title">名称</label>
          <input type="text" class="form-control" id="title" name="title" required />
        </div>
        <div class="form-group">
          <label for="price">价格</label>
          <input type="number" class="form-control" id="price" name="price" required />
        </div>
        <div class="form-group">
          <label for="description">描述</label>
          <textarea class="form-control" rows="3" id="description" name="description" required></textarea>
        </div>
        <div class="form-group">
          <label for="goods_img">商品缩略图</label>
          <input type="file" id="goods_img" name="goods_img" required />
        </div>
      </div>
      <div class="tab-pane" id="detail">
        <div id="editor"></div>
        <textarea name="content" id="content" style="display: none"></textarea>
      </div>
      <div class="tab-pane" id="attribute">
        123
      </div>
      <div class="tab-pane" id="photo">
        <div id="photoLib"  class="photoLib"></div>
        <div id="photoList"></div>
      </div>
    </div>
    <button type="submit" class="btn btn-primary">提交</button>
  </form>
</div>

<%- include ../public/pageFooter.html %>
<script src="../../../public/plugin/wangEditor/wangEditor.min.js"></script>
<script src="../../../public/plugin/webuploader/js/webuploader.html5only.min.js"></script>
<script src="../../../public/plugin/webuploader/js/diyUpload.js"></script>
<script>
  // 富文本
  let E = window.wangEditor
  let editor = new E('#editor')
  let $content = $('#content');
  editor.customConfig.onchange = function (html) {
    // 监控变化，同步更新到 textarea
    $content.val(html)
  }
  editor.customConfig.uploadImgServer = '/admin/goods/editorUpload'; // 上传图片到服务器文件夹
  editor.customConfig.uploadFileName = 'imgFile'; // 图片name
  editor.create();
  // 初始化 textarea 的值
  $content.val(editor.txt.html())

  // 批量上传图片        
  $('#photoLib').diyUpload({
    url: '/admin/goods/editorUpload',
    success:function( res ) {
      let photoStr='<input type="hidden" name="goods_image_list" value='+res.data[0]+' />';
      $('#photoList').append(photoStr);
    },
    error:function( err ) {
      console.info( err );	
    }
  });
</script>